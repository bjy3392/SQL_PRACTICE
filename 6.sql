SELECT COUNT(*) 
  FROM (SELECT PS.PERSON_ID
		  FROM CONDITION_OCCURRENCE CO 
		  JOIN PERSON PS
			ON CO.PERSON_ID = PS.PERSON_ID
		   AND extract(YEAR from now()) - YEAR_OF_BIRTH >= 18 --18세이상
		  JOIN DRUG_EXPOSURE DE 
			ON PS.PERSON_ID = DE.PERSON_ID
		   AND DRUG_CONCEPT_ID = '40163924'
		   AND DE.DRUG_EXPOSURE_END_DATE - DE.DRUG_EXPOSURE_START_DATE >= 90 -- 90일이상 복용
		 WHERE CONDITION_CONCEPT_ID IN ('3191208','36684827','3194332','3193274','43531010','4130162','45766052',
		'45757474','4099651','4129519','4063043','4230254','4193704','4304377','201826','3194082','3192767')
		   AND CO.CONDITION_START_DATE < DE.DRUG_EXPOSURE_START_DATE -- 진단을 받은 이후 약을 복용한 경우
		GROUP BY PS.PERSON_ID) CNT